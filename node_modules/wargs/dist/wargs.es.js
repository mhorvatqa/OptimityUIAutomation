const e=[],r=/$|[!-@[-`{-~][\s\S]*/g,t=Array.isArray,i=function(e){if(""===e)return"";if("false"===e)return!1;const r=Number(e);return 0*r==0?r:e},n=function(r,t,i){let n,o,s,l,f,a,u={};if(void 0!==t)for(f=0,s=t.length;f<s;f++)if(n=t[f],o=r[n],u[n]=i,void 0===o)r[n]=e;else for(a=0,l=o.length;a<l;a++)u[o[a]]=i;return u},o=function(e,r,i,n,o){let s,l,f=n[r],a=void 0===f?-1:f.length;if(a>=0||void 0===o||o(r))for(l=e[r],void 0===l?e[r]=i:t(l)?l.push(i):e[r]=[l,i],s=0;s<a;s++)e[f[s]]=e[r]};var s=function(s,l){let f,a,u,c,d,p=(l=l||{}).unknown,g=function(e){let r,i,n,o,s,l,f,a={};for(r in e)for(s=e[r],i=a[r]=t(s)?s:[s],l=0,o=i.length;l<o;l++)for(n=a[i[l]]=[r],f=0;f<o;f++)l!==f&&n.push(i[f]);return a}(l.alias),h=n(g,l.string,""),v=function(r,t){let i,n,o,s,l,f={};for(i in t)if(o=t[i],n=r[i],f[i]=o,void 0===n)r[i]=e;else for(l=0,s=n.length;l<s;l++)f[n[l]]=o;return f}(g,l.default),y=n(g,l.boolean,!1),b=l.stopEarly,m=[],x={_:m},O=0,A=0,_=s.length;for(;O<_;O++)if(a=s[O],"-"!==a[0]||"-"===a)if(b)for(;O<_;)m.push(s[O++]);else m.push(a);else if("--"===a)for(;++O<_;)m.push(s[O]);else if("-"===a[1])u=a.indexOf("=",2),"n"===a[2]&&"o"===a[3]&&"-"===a[4]?(f=a.slice(5,u>=0?u:void 0),d=!1):u>=0?(f=a.slice(2,u),d=void 0!==y[f]||(void 0===h[f]?i(a.slice(u+1)):a.slice(u+1))):(f=a.slice(2),d=void 0!==y[f]||(_===O+1||"-"===s[O+1][0]?void 0===h[f]||"":void 0===h[f]?i(s[++O]):s[++O])),o(x,f,d,g,p);else for(r.lastIndex=2,c=r.exec(a),u=c.index,d=c[0],A=1;A<u;A++)o(x,f=a[A],A+1<u?void 0===h[f]||a.substring(A+1,A=u)+d:""===d?_===O+1||"-"===s[O+1][0]?void 0===h[f]||"":void 0!==y[f]||(void 0===h[f]?i(s[++O]):s[++O]):void 0!==y[f]||(void 0===h[f]?i(d):d),g,p);for(f in v)void 0===x[f]&&(x[f]=v[f]);for(f in y)void 0===x[f]&&(x[f]=!1);for(f in h)void 0===x[f]&&(x[f]="");return x};const l=e=>`__Symbol@@${e}__`,f=l("QUOTE"),a=l("APOS"),u=l("SPA"),c=/-(\w)/g,d=/^((?!\d)[-~+./\w]+)([=:])(.+?)?$/,p=/(["'])(?:(?!\1).)*\1/,g=['"',"'"," "],h=[/\\"/g,/\\'/g,/\\ /g],v=[f,a,u],y=[f,a,u].map(e=>new RegExp(e,"g"));function b(e){return y.reduce((e,r,t)=>e.replace(r,g[t]),e)}function m(e,r){for(;p.test(e);){const r=e.match(p),t=r[0].substr(1,r[0].length-2);e=e.replace(r[0],g.reduce((e,r,t)=>e.replace(r,v[t]),t))}if(r)for(;e.indexOf(" ")>-1;)e=g.reduce((e,r,t)=>e.replace(r,v[t]),e);return e.split(/\s+/)}function x(e,r){return"function"==typeof r?r(e):e}function O(e){return e.replace(c,(e,r)=>r.toUpperCase())}function A(e,r){if("string"==typeof e){if((r||0===e.indexOf("--"))&&-1===e.indexOf("no-")){if(-1===e.indexOf("="))return r?O(e):`--${O(e.substr(2))}`;let[t,...i]=e.split("=");return t=r?O(t):`--${O(t.substr(2))}`,i=i.length>1?i.join("="):i[0],`${t}=${i}`}return e}return e.map(e=>A(e,r))}export default(e,r,t)=>{if("function"==typeof(r=r||{})&&(t=r,r={}),r.format&&(t=r.format,delete r.format),!Array.isArray(e)){let r;e=function(e){return h.reduce((e,r,t)=>e.replace(r,v[t]),e)}(String(e||""));do{r=e.match(p),r&&(e=e.replace(r[0],m(r[0],!0)))}while(r);e=e.trim().split(/\s+/).map(b).filter(e=>e)}const i=e.indexOf("--"),n=[];i>-1&&(e.slice(i+1).forEach(e=>{n.push(x(e,t))}),e.splice(i+1,e.length)),"string"==typeof r.boolean&&(r.boolean=r.boolean.split("")),"string"==typeof r.string&&(r.string=r.string.split("")),r.boolean&&(r.boolean=A(r.boolean,!0)),r.string&&(r.string=A(r.string,!0)),r.alias&&Object.keys(r.alias).forEach(e=>{r.alias[e]=A(r.alias[e],!0)});const o=s(A(e),r),l=o._.slice();Object.keys(o).forEach(e=>{""===e&&delete o[e],""===o[e]&&(o[e]=null)});const f={},a={};return delete o._,Object.keys(o).forEach(e=>{const i=o[e];-1!==e.indexOf("-")&&(delete o[e],e=O(e)),r.alias&&r.alias[e]&&0===r.alias[e].indexOf("no-")&&(o[r.alias[e]]&&(o[r.alias[e].substr(3)]=!1),o[e]=!0),Array.isArray(i)&&(o[e]=i.map(e=>x(e,t))),"string"==typeof i&&("="===i.charAt()?o[e]=x(i.substr(1),t):o[e]=x(i,t))}),{_:l.reduce((e,r)=>{const i=r.match(d);return i?"="===i[2]?f[i[1]]=x(i[3]||"",t):a[i[1]]?(Array.isArray(a[i[1]])||(a[i[1]]=[a[i[1]]]),a[i[1]].push(x(i[3]||"",t))):a[i[1]]=x(i[3]||"",t):e.push(x(r,t)),e},[]),raw:n,data:f,flags:o,params:a}};
